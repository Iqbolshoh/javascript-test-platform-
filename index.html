<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Challenge | By Iqbolshoh</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="https://iqbolshoh.uz/favicon.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
    <link rel="stylesheet" href="./src/css/style.css">
</head>

<body>
    <select id="vocab-select" class="form-select" onchange="loadVocabulary()">
        <option value="" disabled selected>Lug‚Äòatni tanlang</option>
        <option value="./src/js/vocabulary8.json">Vocabulary 8</option>
        <option value="./src/js/vocabulary9.json">Vocabulary 9</option>
    </select>

    <select id="mode-select" class="form-select" onchange="loadQuestion()">
        <option value="word" selected>Word ‚Üí Translation</option>
        <option value="Translation">Translation ‚Üí Word</option>
    </select>

    <div class="card d-none" id="game-card">
        <h4 id="question-number" class="text-muted"></h4>
        <h2 id="word-container">
            <span id="word">üîÑ</span>
            <i class="fa fa-volume-up speaker-icon" onclick="speakText()"></i>
        </h2>
        <p id="emoji" class="fs-1">‚ùì</p>
        <div id="options" class="d-grid gap-3"></div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const vocabSelect = document.getElementById("vocab-select");
            const modeSelect = document.getElementById("mode-select");
            const gameCard = document.getElementById("game-card");
            const wordContainer = document.getElementById("word");
            const emojiContainer = document.getElementById("emoji");
            const questionNumber = document.getElementById("question-number");
            const optionsContainer = document.getElementById("options");

            let vocabulary = [];
            let currentIndex = 0;
            let mistakeCount = 0;
            let mode = "translation";

            vocabSelect.addEventListener("change", loadVocabulary);
            modeSelect.addEventListener("change", () => {
                mode = modeSelect.value;
                loadQuestion();
            });

            async function loadVocabulary() {
                const vocabFile = vocabSelect.value;
                if (!vocabFile) return;

                try {
                    const response = await fetch(vocabFile);
                    vocabulary = await response.json();
                    currentIndex = mistakeCount = 0;
                    gameCard.classList.remove("d-none");
                    modeSelect.style.display = "block";
                    loadQuestion();
                } catch (error) {
                    console.error("Xatolik yuz berdi:", error);
                }
            }

            function loadQuestion() {
                if (currentIndex >= vocabulary.length) {
                    return Swal.fire({ title: "üéâ Ajoyib natija!", text: "Siz barcha so‚Äòzlarni to‚Äòg‚Äòri topdingiz!", icon: "success", confirmButtonText: "Qayta boshlash", position: "top", backdrop: false }).then(resetGame);
                }

                const currentWord = vocabulary[currentIndex];
                const questionText = capitalize(mode === "word" ? currentWord.word : currentWord.translation);
                const correctAnswer = capitalize(mode === "word" ? currentWord.translation : currentWord.word);

                wordContainer.innerText = questionText;
                emojiContainer.innerText = currentWord.emoji;
                questionNumber.innerText = `Savol ${currentIndex + 1} / ${vocabulary.length}`;

                generateOptions(correctAnswer);
            }

            function generateOptions(correctAnswer) {
                let options = new Set([correctAnswer]);
                while (options.size < 3) {
                    let randomWord = capitalize(vocabulary[Math.floor(Math.random() * vocabulary.length)][mode === "word" ? "translation" : "word"]);
                    options.add(randomWord);
                }

                optionsContainer.innerHTML = shuffle([...options]).map(option =>
                    `<button class="btn" onclick="checkAnswer('${option}')">${option}</button>`
                ).join("");
            }

            window.checkAnswer = function (selected) {
                const correctAnswer = capitalize(vocabulary[currentIndex][mode === "word" ? "translation" : "word"]);

                if (selected === correctAnswer) {
                    Swal.fire({ title: "‚úÖ To‚Äòg‚Äòri!", text: "Davom etamiz!", icon: "success", timer: 1000, showConfirmButton: false, position: "top", backdrop: false });
                    currentIndex++;
                    setTimeout(loadQuestion, 1000);
                } else {
                    mistakeCount++;
                    if (mistakeCount >= 5) {
                        Swal.fire({ title: "‚ùå Juda ko‚Äòp xato qildingiz!", text: "O‚Äòyin qayta boshlanadi.", icon: "error", confirmButtonText: "OK", position: "top", backdrop: false }).then(resetGame);
                    } else {
                        Swal.fire({ title: "‚ùå Noto‚Äòg‚Äòri!", text: `Siz ${mistakeCount} ta xato qildingiz. 5 ta xatodan keyin o‚Äòyin tugaydi!`, icon: "error", timer: 1500, showConfirmButton: false, position: "top", backdrop: false });
                    }
                }
            }

            function resetGame() {
                currentIndex = mistakeCount = 0;
                loadQuestion();
            }

            window.speakText = function () {
                let text = wordContainer.innerText.trim();
                let speech = new SpeechSynthesisUtterance(text);
                speech.lang = "en-US";
                window.speechSynthesis.speak(speech);
            }

            function capitalize(text) {
                return text.charAt(0).toUpperCase() + text.slice(1);
            }

            function shuffle(array) {
                return array.sort(() => Math.random() - 0.5);
            }
        });
    </script>
</body>

</html>